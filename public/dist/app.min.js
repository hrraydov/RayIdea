var app=angular.module("app",["ngRoute","btford.socket-io","ui.slider","ui.date","ui.sortable","ngCookies","pascalprecht.translate"]);app.config(["$routeProvider","$httpProvider","$translateProvider",function(a,b,c){a.when("/",{controller:"HomeCtrl",templateUrl:"/views/home.html"}).when("/chat",{controller:"ChatCtrl",templateUrl:"/views/chat.html"}).otherwise({redirectTo:"/"}),c.preferredLanguage("en"),c.useLocalStorage(),b.interceptors.push("TokenInterceptor")}]),angular.module("app").controller("AccountLoginCtrl",["$scope","$location","AccountService","TokenService","AuthService",function(a,b,c,d,e){a.errors=[],a.login=function(){c.login(a.user).then(function(a){d.setToken(a.token),e.setUsername(a.username),e.setId(a._id),b.path("/")},function(b){a.errors=b})}}]),angular.module("app").controller("AccountRegisterCtrl",["$scope","$location","AccountService","TokenService","AuthService",function(a,b,c,d,e){a.errors=[],a.register=function(){c.register(a.user).then(function(a){d.setToken(a.token),e.setUsername(a.username),e.setId(a._id),b.path("/")},function(b){a.errors=b})}}]),angular.module("app").controller("ChatCtrl",["$scope","AuthService","ChatService",function(a,b,c){a.message={},a.user={},a.users=["first","second","hrraydov"],a.openChat=function(d){a.user=d,c.loadChat(b.getUsername(),d)},a.sendMessage=function(){c.sendMessage(b.getUsername(),user,a.message.content)},a.$on("socket:receiveMessages",function(b){a.messages=b}),a.$on("socket:receiveMessage",function(b){a.messages.push(b)})}]),angular.module("app").controller("HomeCtrl",["$scope","AuthService",function(a,b){a.message="Simple message",a.isLogged=b.isAuthenticated()}]),angular.module("app").controller("ProfileEditCtrl",["$scope","ProfileService",function(a,b){var c=function(){b.get().then(function(b){a.user=b})};c(),a.errorMessages=[],a.successMessages=[],a.edit=function(){b.edit(a.user).then(function(){a.successMessages.push("Profile edited successfully")},function(b){a.errorMessages=[];for(var c=0;c<b.errors.length;c++)a.errorMessages.push(b.errors[c].msg)})}}]),angular.module("app").controller("ProjectsCreateCtrl",["$scope","$location","ProjectsService",function(a,b,c){a.project={type:"public"},a.create=function(){c.create(a.project).then(function(){b.path("/projects/my")})}}]),angular.module("app").controller("ProjectsEditCtrl",["$scope","ProjectsService",function(a,b){var c=function(){b.getAll().then(function(b){a.projects=b})};c()}]),angular.module("app").controller("ProjectsMyCtrl",["$scope","ProjectsService",function(a,b){var c=function(a){var c=this;c.page=1,c.pages=1,c.projects=[],c.load=function(){a().then(function(a){c.projects=a})},c.delete=function(a){b.delete(a._id).then(function(){c.load()})},c.cancel=function(a){b.cancel(a._id).then(function(){c.load()})}};a.owner=new c(b.getOwnerOf),a.owner.load(),a.candidate=new c(b.getCandidateFor),a.candidate.load(),a.member=new c(b.getMemberOf),a.member.load()}]),angular.module("app").controller("ProjectsShowCtrl",["$scope","$routeParams","AuthService","ProjectsService",function(a,b,c,d){a.project={},a.isOwner=!1,a.isMember=!1,d.getById(b.id).then(function(b){a.project=b,c.isAuthenticated&&b.owner.account.username==c.getUsername()&&(a.isOwner=!0,a.isMember=!0),c.isAuthenticated&&-1!=b.members.indexOf(c.getId())&&(a.isMember=!0)}),a.becomeMember=function(){d.becomeMember(b.id).then(function(){},function(){})},a.acceptMember=function(a){d.acceptMember(b.id,a._id).then(function(){},function(){})}}]),angular.module("app").controller("SkillsEditCtrl",["$scope","SkillsService",function(a,b){var c=function(){b.get().then(function(b){a.skills=b})};c(),a.errorMessages=[],a.successMessages=[],a.addSkill=function(){a.skills.push({name:"",value:5})},a.save=function(){for(var c=[],d=0;d<a.skills.length;d++)""!==a.skills[d].name&&a.skills[d].value>=0&&a.skills[d].value<=10&&c.push(a.skills[d]);a.skills=c,b.edit(c).then(function(){a.successMessages.push("Skills edited successfully")},function(b){a.errorMessages=[];for(var c=0;c<b.errors.length;c++)a.errorMessages.push(b.errors[c].msg)})}}]),angular.module("app").controller("UserShowCtrl",["$scope","$routeParams","$location","UserService","AuthService",function(a,b,c,d,e){var f=function(){d.getByUsername(b.username).then(function(b){console.log(b),a.profile=b.profile,a.username=b.username,a.skills=b.skills,a.profile.name.full=b.profile.name.full,a.projects=b.projects},function(b){404==b.statusCode&&(a.profileNotFound=!0)})};a.profileNotFound=!1,a.activeTab="information",a.currentProfile=b.username===e.getUsername(),console.log(b.username===e.getUsername()),a.openTab=function(b){a.activeTab=b},f()}]),angular.module("app").directive("messages",function(){return{restrict:"E",scope:{errorMessages:"=errorMessages",successMessages:"=successMessages",infoMessages:"=infoMessages"},templateUrl:"src/js/directives/messages/messages.html"}}),angular.module("app").directive("navigation",function(){return{restrict:"E",controller:["$scope","$rootScope","$location","$translate","AuthService","AccountService","TokenService",function(a,b,c,d,e,f,g){var h=function(){switch(c.path()){case"/register":a.active="register";break;case"/login":a.active="login";break;case"/profile/"+a.username:a.active="my-profile";break;case"/projects":a.active="projects";break;default:a.active=""}},i=function(){a.isLogged=e.isAuthenticated(),a.username=e.getUsername()};h(),i(),a.logout=function(){console.log("Logout"),f.logout().then(function(){g.deleteToken(),c.path("/"),i()})},a.changeLanguage=function(a){d.use(a)},b.$on("$routeChangeSuccess",function(){h(),i()})}],templateUrl:"src/js/directives/navigation/navigation.html"}}),angular.module("app").config(["$translateProvider",function(a){a.translations("bg",{MESSAGE:"Saobshtenie"})}]),angular.module("app").config(["$translateProvider",function(a){a.translations("en",{MESSAGE:"message"})}]),angular.module("app").config(["$routeProvider",function(a){a.when("/register",{controller:"AccountRegisterCtrl",templateUrl:"/views/account/register.html"}).when("/login",{controller:"AccountLoginCtrl",templateUrl:"/views/account/login.html"})}]),angular.module("app").config(["$routeProvider",function(a){a.when("/profile",{controller:"ProfileEditCtrl",templateUrl:"/views/profile/edit.html"})}]),angular.module("app").config(["$routeProvider",function(a){a.when("/projects/my",{controller:"ProjectsMyCtrl",templateUrl:"/views/projects/my.html"}).when("/projects/create",{controller:"ProjectsCreateCtrl",templateUrl:"/views/projects/create.html"}).when("/projects/:id",{controller:"ProjectsShowCtrl",templateUrl:"/views/projects/show.html"})}]),angular.module("app").config(["$routeProvider",function(a){a.when("/skills",{controller:"SkillsEditCtrl",templateUrl:"/views/skills/edit.html"})}]),angular.module("app").config(["$routeProvider",function(a){a.when("/user/:username",{controller:"UserShowCtrl",templateUrl:"/views/user/show.html"})}]),angular.module("app").factory("AccountService",["$q","$http",function(a,b){return{register:function(c){var d=a.defer();return b.post("/api/account/register",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},login:function(c){var d=a.defer();return b.post("/api/account/login",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},logout:function(){var c=a.defer();return b.get("/api/account/logout").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}}}]),angular.module("app").factory("AuthService",["$window",function(a){return{isAuthenticated:function(){return a.sessionStorage.token?!0:!1},getUsername:function(){return a.sessionStorage.username},setUsername:function(b){a.sessionStorage.username=b},deleteUsername:function(){delete a.sessionStorage.username},getId:function(){return a.sessionStorage.id},setId:function(b){a.sessionStorage.id=b},deleteId:function(){delete a.sessionStorage.id}}}]),angular.module("app").factory("ChatService",["socketFactory",function(a){var b=a({ioSocket:io.connect("/chat")});return b.forward("receiveMessage"),b.forward("receiveMessages"),b.sendMessage=function(a,c,d){b.emit("sendMessage",{sender:a,receiver:c,content:d})},b.loadChat=function(a,c){b.emit("loadChat",{username1:a,username2:c})},b.connectRequest=function(a){b.emit("connectRequest",a)},b}]),angular.module("app").factory("LangService",["$window",function(a){var b="en",c=["en","bg"];return{get:function(){return a.localStorage.lang?a.localStorage.lang:b},set:function(b){for(var d=0;d<c.length;d++)if(c[d]==b)return void(a.localStorage.lang=b)}}}]),angular.module("app").factory("ProfileService",["$q","$http",function(a,b){return{edit:function(c){var d=a.defer();return b.put("/api/profile",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},get:function(){var c=a.defer();return b.get("/api/profile").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}}}]),angular.module("app").factory("ProjectsService",["$q","$http",function(a,b){return{getById:function(c){var d=a.defer();return b.get("/api/projects/"+c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},getAll:function(){var c=a.defer();return b.get("/api/projects").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},getOwnerOf:function(){var c=a.defer();return b.get("/api/projects/owner-of").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},getCandidateFor:function(){var c=a.defer();return b.get("/api/projects/candidate-for").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},getMemberOf:function(){var c=a.defer();return b.get("/api/projects/member-of").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},create:function(c){var d=a.defer();return b.post("/api/projects",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},"delete":function(c){var d=a.defer();return b.delete("/api/projects/"+c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},becomeMember:function(c){var d=a.defer();return b.put("/api/projects/"+c+"/become-member").success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},cancel:function(c){var d=a.defer();return b.put("/api/projects/"+c+"/cancel-candidature").success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},acceptMember:function(c,d){var e=a.defer();return b.put("/api/projects/"+c+"/accept-member/"+d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},declineMember:function(c,d){var e=a.defer();return b.put("/api/projects/"+c+"/decline-member/"+d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise}}}]),angular.module("app").factory("SkillsService",["$q","$http",function(a,b){return{edit:function(c){var d=a.defer();return b.put("/api/skills",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},get:function(){var c=a.defer();return b.get("/api/skills").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}}}]),angular.module("app").factory("TokenInterceptor",["$q","$location","TokenService","AuthService",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.getToken()&&(a.headers.Authorization="Bearer "+c.getToken()),a},requestError:function(b){return a.reject(b)},response:function(b){return b||a.when(b)},responseError:function(e){return null!==e&&401===e.status&&(c.deleteToken(),d.deleteUsername(),d.deleteId(),b.path("/login")),a.reject(e)}}}]),angular.module("app").factory("TokenService",["$window",function(a){return{getToken:function(){return a.sessionStorage.token},setToken:function(b){a.sessionStorage.token=b},deleteToken:function(){delete a.sessionStorage.token}}}]),angular.module("app").factory("UserService",["$q","$http",function(a,b){return{getByUsername:function(c){var d=a.defer();return b.get("/api/user/"+c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject({data:a,statusCode:b})}),d.promise}}}]);