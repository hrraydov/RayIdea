var app=angular.module("app",["ngRoute"]);app.config(["$routeProvider","$httpProvider","$provide",function(a,b){a.when("/",{controller:"HomeCtrl",templateUrl:"/views/home.html"}).when("/register",{controller:"AccountRegisterCtrl",templateUrl:"/views/account/register.html"}).when("/login",{controller:"AccountLoginCtrl",templateUrl:"/views/account/login.html"}).when("/profile/:username",{controller:"ProfileShowCtrl",templateUrl:"/views/profile/show.html"}).when("/profile/edit",{controller:"ProfileEditCtrl",templateUrl:"/views/profile/edit.html"}).otherwise({redirectTo:"/"}),b.interceptors.push("TokenInterceptor")}]),angular.module("app").controller("AccountLoginCtrl",["$scope","$location","UserService","TokenService","AuthService",function(a,b,c,d,e){a.errors=[],a.login=function(){c.login(a.user).then(function(a){d.setToken(a.token),e.setUsername(a.username),b.path("/")},function(b){a.errors=b})}}]),angular.module("app").controller("AccountRegisterCtrl",["$scope","$location","UserService","TokenService","AuthService",function(a,b,c,d,e){a.errors=[],a.register=function(){c.register(a.user).then(function(a){d.setToken(a.token),e.setUsername(a.username),b.path("/")},function(b){a.errors=b})}}]),angular.module("app").controller("HomeCtrl",["$scope","AuthService",function(a,b){a.message="Simple message",a.isLogged=b.isAuthenticated()}]),angular.module("app").controller("ProfileEditCtrl",["$scope","ProfileService",function(a,b){var c=function(){b.getCurrent().then(function(b){a.user=b})};c(),a.errorMessages=[],a.edit=function(){b.edit(a.user).then(function(){},function(b){a.errorMessages=[];for(var c=0;c<b.errors.length;c++)a.errorMessages.push(b.errors[c].msg)})}}]),angular.module("app").controller("ProfileShowCtrl",["$scope","$routeParams","$location","ProfileService","AuthService",function(a,b,c,d){var e=function(){d.getByUsername(b.username).then(function(b){a.profile=b},function(b){404==b.statusCode&&(a.profileNotFound=!0)})};a.profileNotFound=!1,e()}]),angular.module("app").directive("messages",function(){return{restrict:"E",scope:{errorMessages:"=errorMessages",successMessages:"=successMessages",infoMessages:"=infoMessages"},templateUrl:"src/js/directives/message/message.html"}}),angular.module("app").directive("navigation",function(){return{restrict:"E",controller:["$scope","$rootScope","$location","AuthService","UserService","TokenService",function(a,b,c,d,e,f){var g=function(){switch(c.path()){case"/register":a.active="register";break;case"/login":a.active="login";break;case"/profile/"+a.username:a.active="my-profile";break;default:a.active=""}},h=function(){a.isLogged=d.isAuthenticated(),a.username=d.getUsername()};g(),h(),a.logout=function(){e.logout().then(function(){f.deleteToken(),c.path("/"),h()})},b.$on("$routeChangeSuccess",function(){g(),h()})}],templateUrl:"src/js/directives/navigation/navigation.html"}}),angular.module("app").factory("AuthService",["$window",function(a){return{isAuthenticated:function(){return a.sessionStorage.token?!0:!1},getUsername:function(){return a.sessionStorage.username},setUsername:function(b){a.sessionStorage.username=b},deleteUsername:function(){delete a.sessionStorage.username}}}]),angular.module("app").factory("ProfileService",["$q","$http",function(a,b){return{edit:function(c){var d=a.defer();return b.put("/api/profile",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},getCurrent:function(){var c=a.defer();return b.get("/api/profile/current").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},getByUsername:function(c){var d=a.defer();return b.get("/api/profile/"+c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject({data:a,statusCode:b})}),d.promise}}}]),angular.module("app").factory("TokenInterceptor",["$q","$location","TokenService","AuthService",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.getToken()&&(a.headers.Authorization="Bearer "+c.getToken()),a},requestError:function(b){return a.reject(b)},response:function(b){return b||a.when(b)},responseError:function(e){return null!==e&&401===e.status&&c.getToken()&&(c.deleteToken(),d.deleteUsername(),b.path("/login")),a.reject(e)}}}]),angular.module("app").factory("TokenService",["$window",function(a){return{getToken:function(){return a.sessionStorage.token},setToken:function(b){a.sessionStorage.token=b},deleteToken:function(){delete a.sessionStorage.token}}}]),angular.module("app").factory("UserService",["$q","$http",function(a,b){return{register:function(c){var d=a.defer();return b.post("/api/account/regsiter",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},login:function(c){var d=a.defer();return b.post("/api/account/login",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},logout:function(){var c=a.defer();return b.get("/api/account/logout").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}}}]);