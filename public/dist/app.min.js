var app=angular.module("app",["ngRoute"]);app.config(["$routeProvider","$httpProvider","$provide",function(a,b){a.when("/",{controller:"HomeCtrl",templateUrl:"/views/home.html"}).when("/register",{controller:"AccountRegisterCtrl",templateUrl:"/views/account/register.html"}).when("/login",{controller:"AccountLoginCtrl",templateUrl:"/views/account/login.html"}).when("/profile/edit",{controller:"ProfileEditCtrl",templateUrl:"/views/profile/edit.html"}).otherwise({redirectTo:"/"}),b.interceptors.push("TokenInterceptor")}]),angular.module("app").controller("AccountLoginCtrl",["$scope","$location","UserService","TokenService",function(a,b,c,d){a.errors=[],a.login=function(){c.login(a.user).then(function(a){d.setToken(a.token),b.path("/")},function(b){a.errors=b})}}]),angular.module("app").controller("AccountRegisterCtrl",["$scope","$location","UserService","TokenService",function(a,b,c,d){a.errors=[],a.register=function(){c.register(a.user).then(function(a){d.setToken(a.token),b.path("/")},function(b){a.errors=b})}}]),angular.module("app").controller("HomeCtrl",["$scope","AuthService",function(a,b){a.message="Simple message",a.isLogged=b.isAuthenticated()}]),angular.module("app").controller("ProfileEditCtrl",["$scope","ProfileService",function(a,b){a.edit=function(){b.edit(a.user).then(function(){})}}]),angular.module("app").directive("navigation",function(){return{restrict:"E",controller:["$scope","$rootScope","$location","AuthService","UserService","TokenService",function(a,b,c,d,e,f){var g=function(){switch(c.path()){case"/register":a.active="register";break;case"/login":a.active="login";break;default:a.active=""}},h=function(){a.isLogged=d.isAuthenticated()};g(),h(),a.logout=function(){e.logout().then(function(){f.deleteToken(),c.path("/"),h()})},b.$on("$routeChangeSuccess",function(){g(),h()})}],templateUrl:"src/js/directives/navigation/navigation.html"}}),angular.module("app").factory("AuthService",["$window",function(a){return{isAuthenticated:function(){return a.sessionStorage.token?!0:!1}}}]),angular.module("app").factory("ProfileService",["$q","$http",function(a,b){return{edit:function(c){var d=a.defer();return b.put("/api/profile/edit",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise}}}]),angular.module("app").factory("TokenInterceptor",["$q","$location","TokenService",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.getToken()&&(a.headers.Authorization="Bearer "+c.getToken()),a},requestError:function(b){return a.reject(b)},response:function(b){return b||a.when(b)},responseError:function(d){return null!==d&&401===d.status&&c.getToken()&&(c.deleteToken(),b.path("/login")),a.reject(d)}}}]),angular.module("app").factory("TokenService",["$window",function(a){return{getToken:function(){return a.sessionStorage.token},setToken:function(b){a.sessionStorage.token=b},deleteToken:function(){delete a.sessionStorage.token}}}]),angular.module("app").factory("UserService",["$q","$http",function(a,b){return{register:function(c){var d=a.defer();return b.post("/api/account/regsiter",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},login:function(c){var d=a.defer();return b.post("/api/account/login",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},logout:function(){var c=a.defer();return b.get("/api/account/logout").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}}}]);